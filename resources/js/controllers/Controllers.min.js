Professionals.controller("UsersController",["$scope","$routeParams","$http","$rootScope","$timeout","$location","CommonService","Helper",function(a,h,k,d,m,e,l,g){a.users=[];a.loader=!0;a.showUnauthorized=!1;a.currentUserIsAdmin=!1;a.getAllUsers=function(){m(function(){l.getRequest("api/users").then(function(b){b.data.map(function(a){if(null!==a.direccion||void 0!==a.direccion)a.direccion=$.parseJSON(a.direccion)});a.users=b.data;a.loader=!1})},1E3)};a.init=function(){g.getUser().then(function(b){b.IsAdmin?
(a.currentUserIsAdmin=!0,a.getAllUsers()):a.showUnauthorized=!0})};a.changeUserState=function(a){l.postJsonRequest("api/update_userState",{username:a.username}).then(function(c){c.success?(a.IsActive=1===a.IsActive?0:1,d.$broadcast("alert-event",{type:"success",msg:c.msg})):d.$broadcast("alert-event",{type:"danger",msg:c.msg})})};a.init()}]);Professionals.controller("HeaderController",["$scope","$routeParams","$http","$rootScope","$location","$modal","CommonService","Helper",function(a,h,k,d,m,e,l,g){a.template={header:"resources/tpl/header.html"};a.items=["item1","item2","item3"];a.ingresarAction=function(a,c){a.preventDefault();a.stopPropagation();e.open({templateUrl:"resources/tpl/login.html",controller:"LoginController",size:c}).result.then(function(){},function(){})};a.salirAction=function(a){a.preventDefault();a.stopPropagation();
l.postJsonRequest("api/logout-user",{}).then(function(a){a.success?(m.path("/"),d.$broadcast("alert-event",{type:"success",msg:"Ha salido con exito! Hasta la proxima :)"}),delete d.user):d.$broadcast("alert-event",{type:"danger",msg:a.msg})})};a.init=function(){g.getUser().then()};a.init()}]);Professionals.controller("AlertController",["$scope","$routeParams","$http","$rootScope","$location","$timeout",function(a,h,k,d,m,e){a.alerts=[];a.$on("alert-event",function(d,g){a.addAlert(g);e(function(){$(".alertsTop button").removeClass("ng-hide")},5)});a.addAlert=function(d){"danger"===d.type&&a.alerts.forEach(function(b,c){debugger;"danger"===b.type&&a.closeAlert(c)});a.alerts.push(d);var g=a.alerts.length-1;e(function(){a.closeAlert(g)},5E3)};a.closeAlert=function(d){a.alerts.splice(d,1)}}]);Professionals.controller("HomeController",["$scope","$routeParams","$http","$rootScope","$location",function(a,h,k,d,m){}]);Professionals.controller("FooterController",["$scope",function(a){a.template={footer:"resources/tpl/footer.html"}}]);Professionals.controller("LoginController",["$scope","$routeParams","$http","$rootScope","$location","$modalInstance","CommonService",function(a,h,k,d,m,e,l){a.ok=function(){e.close(a.selected.item)};a.cancel=function(a){a.preventDefault();e.dismiss("cancel")};a.userLogin={};a.loginUser=function(g){g.preventDefault();l.postUrlEncoded("api/login-user",{username:a.userLogin.username,password:a.userLogin.password}).then(function(a){a.success?(d.$broadcast("alert-event",{type:"success",msg:"Bienvenido "+
a.data.username+" !"}),d.user=a.data,e.close(0),d.user.IsAdmin?m.path("/administrar-users"):m.path("/ver-usuario")):d.$broadcast("alert-event",{type:"danger",msg:a.msg})})}}]);Professionals.controller("ContactoController",["$scope","$routeParams","$http","$rootScope","$location","CommonService",function(a,h,k,d,m,e){a.gRecaptchaResponse="";a.$watch("gRecaptchaResponse",function(){a.expired=!1});a.expiredCallback=function(){a.expired=!0};a.enviarMail=function(l){l?e.postJsonRequest("api/sendMail",a.user).then(function(a){a.data.success?d.$broadcast("alert-event",{type:"success",msg:"Has sido registrado con exito"}):d.$broadcast("alert-event",{type:"danger",msg:a.data.msg})}):
d.$broadcast("alert-event",{type:"danger",msg:"Existen errores en el formulario!"})}}]);Professionals.controller("TopPropagandaController",["$scope","$routeParams","$http","$rootScope","$location",function(a,h,k,d,m){a.template={topPropaganda:"resources/tpl/topPropaganda.html"};a.myInterval=3E3;var e=a.slides=[];a.addSlide=function(a){e.push({image:a,text:["More","Extra","Lots of"][e.length%3]+" "+["Cats","Kittys","Felines"][e.length%3]})};a.addSlide("./resources/img/dentista.jpg");a.addSlide("./resources/img/profesionales.jpg");a.addSlide("./resources/img/contador.jpg")}]);Professionals.controller("ProfessionalsSearchController",["$scope","$routeParams","$http","$rootScope","$location","CommonService","departamentosList","categoriasList","barriosList",function(a,h,k,d,m,e,l,g,b){function c(){a.isCollapsed=!0;e.getRequest("api/users/"+a.selectedCategoria.categoriaId+"/"+a.depSelected.idDepartamento+(void 0!==a.buscoProf&&""!==a.buscoProf?"/"+a.buscoProf:"")).then(function(b){b.success?(a.users=[],b=b.data,a.totalItems=b.length,a.currentPage=1,a.users=b,a.users.map(function(a){if(null!==
a.markers||void 0!==a.markers)a.markers=$.parseJSON(a.markers);if(null!==a.direccion||void 0!==a.direccion)a.direccion=$.parseJSON(a.direccion)}),a.pageChanged()):(a.users=[],a.totalItems=0,a.currentPage=1)})}a.categorias=g.data;a.categorias.unshift({categoriaNombre:"Seleccione Categoria",categoriaId:-1});a.selectedCategoria=a.categorias[0];a.barrios=b.data;a.barrios.unshift({barrioNombre:"Seleccione Barrio",id:-1});a.selectedBarrio=a.barrios[0];a.usersViewList=[];a.isCollapsed=!0;a.selectedUser=
null;a.showUserInfo=function(b){a.isCollapsed=b!==a.selectedUser?!1:!a.isCollapsed;a.selectedUser=b};a.departamentosList=l.data;a.departamentosList.unshift({nombreDepartamento:"Seleccione Departamento",idDepartamento:-1});a.depSelected=a.departamentosList[0];a.users=null;a.selectDepartamento=function(b,d){b.preventDefault();a.depSelected=d;-1!==a.selectedCategoria.categoriaId&&(-1!==d.idDepartamento||void 0!==a.buscoProf&&""!==a.buscoProf.trim())&&c()};a.selectCategoria=function(b,d){b.preventDefault();
a.selectedCategoria=d;-1!==a.depSelected.idDepartamento&&c()};a.pageChanged=function(){var b=6*(a.currentPage-1);a.usersViewList=a.users.slice(b,b+6)};a.myInterval=4E3;var p=a.slides=[];a.addSlide=function(a,b,n,f){p.push({image:a,text:b,subText:n,categoria:f})};a.addSlide("./resources/img/profesionalesSearch.jpg","\u00bfBuscas un dentista?","Encuentra al profesional que est\u00e1s buscando","Odont\u00f3logos");a.addSlide("./resources/img/contador.jpg","\u00bfBuscas un contador?","Encuentra al profesional que est\u00e1s buscando",
"Contadores");a.addSlide("./resources/img/handshake.jpg","\u00bfBuscas un contador?","Encuentra al profesional que est\u00e1s buscando","Contadores");a.setDropdownsAndExecuteQuery=function(b){a.selectedCategoria=a.categorias.filter(function(a){return a.categoriaNombre===b})[0];a.depSelected=a.departamentosList.filter(function(a){return"Montevideo"===a.nombreDepartamento})[0];c()};a.totalItems=0;a.currentPage=1;a.maxSize=6;a.setPage=function(b){a.currentPage=b};a.$watch("buscoProf",function(a,
b){void 0!==a&&a!==b&&0<a.length&&c()})}]);Professionals.controller("RegisterUserController",["$scope","$rootScope","$location","CommonService","departamentosList","categoriasList","barriosList","planes","Helper","userData","newUser","$timeout",function(a,h,k,d,m,e,l,g,b,c,p,q){function r(){this.val=""}a.$watch("files",function(n,b){void 0!==n&&null!==n&&0<n.length&&(a.validateImg(a.files),a.user.cardcolor=void 0)});a.$watch("user.cardcolor",function(n){void 0!==n&&null!==n&&(a.files=[])});a.planes=g;a.newUser=p;a.isCollapsed=p;a.editMode=
p;a.renderMap=!1;a.direcciones=[];a.addDireccion=function(){a.direcciones.push(new r)};a.removeDireccionesVacias=function(){for(var n=a.direcciones.length;n--;)""==a.direcciones[n].val&&a.direcciones.pop()};a.removeDireccion=function(n){for(var b=a.direcciones.length;b--;)a.direcciones[b].$$hashKey===n.$$hashKey&&(a.direcciones.splice(b,1),b=0)};a.profesionalesAvailablePlans={0:{Basico:{Mensual:490,Semestral:2352,Anual:3528},Premium:{Mensual:890,Semestral:4272,Anual:6408}},1:{Basico:{Mensual:790,
Semestral:3792,Anual:5688},Premium:{Mensual:1190,Semestral:5712,Anual:8568}}};a.convertIntToPlanType=function(a){return 0===a?"Profesional":"Empresarial"};a.getPlan=function(n,b,c){return a.planes.data.filter(function(a){return a.Tipo===n&&a.Categoria===b&&a.DuracionPlan===c})};a.getPlanCash=function(b,f,c){b=a.getPlan(b,f,c);return 0<b.length?b.Precio:0};a.selectedPlan={};a.showPlan=function(b){a.selectedPlan.tipo===b?(a.isCollapsed=!0,a.selectedPlan={}):(a.selectedPlan.tipo=b,a.selectedPlan.nombre=
0===b?"Planes Profesionales":"Planes Empresariales",a.isCollapsed=!1)};a.validateImg=function(a){if(a&&a.length){a=a[0];var b;-1===a.type.indexOf("image")&&(b="Image extension not allowed, please choose a JPEG or PNG file.");2097152<a.size&&(b="File size cannot exceed 2 MB");void 0!==b&&h.$broadcast("alert-event",{type:"danger",msg:b})}};a.registro={mostrarRegistro:!p,empresa:6<c.plan};a.goBackRegistration=function(b){b.preventDefault();p?(a.registro.mostrarRegistro=!1,a.registro.empresa=!1):k.path("/ver-usuario")};
a.showRegistration=function(b,f,c,d){goToTop();b.preventDefault();a.userPlan=a.getPlan(a.convertIntToPlanType(f),d,c);0<a.userPlan.length&&(a.IdPlan=a.userPlan[0].IdPlan);a.registro.mostrarRegistro=!0;a.registro.empresa=1===a.selectedPlan.tipo};a.$watch("registro.mostrarRegistro",function(b){null===b||void 0===b||!b||void 0!==p&&!0!==p?a.renderMap=!1:q(function(){a.renderMap=!0},1E3)});a.defaultDropdownTexts={checkAll:"Seleccionar Todos",uncheckAll:"Remover Todos",dynamicButtonTextSuffix:"Seleccionados"};
a.showBarrios=!1;a.montevideoSelected=function(b){1===b.id&&(a.showBarrios=!0);a.dropdownsValid=a.dropDownCheck()};a.montevideoDeSelected=function(b){1===b.id&&(a.showBarrios=!1,a.selectedBarrios=[]);a.dropdownsValid=a.dropDownCheck()};a.selectAllDeps=function(){a.showBarrios=!0;a.dropdownsValid=a.dropDownCheck()};a.removeAllDeps=function(){a.showBarrios=!1;a.dropdownsValid=a.dropDownCheck()};a.DepartamentosEvents={onItemSelect:a.montevideoSelected,onItemDeselect:a.montevideoDeSelected,onSelectAll:a.selectAllDeps};
a.$watch("selectedDepartamentos.length",function(b){0===b&&(a.showBarrios=!1);a.dropdownsValid=a.dropDownCheck()});a.categoriasTexts=$.extend({},a.defaultDropdownTexts,{buttonDefaultText:"Seleccione Categorias"});a.categoriaSettings={displayProp:"categoriaNombre",idProp:"categoriaId"};a.categorias=e.data;a.selectedCategorias=[];a.barriosTexts=$.extend({},a.defaultDropdownTexts,{buttonDefaultText:"Seleccione Barrios"});a.barriosSettings={displayProp:"barrioNombre",idProp:"barrioId"};a.barrios=$.grep(l.data,
function(a){return 82>a.barrioId});a.selectedBarrios=[];a.departamentosTexts=$.extend({},a.defaultDropdownTexts,{buttonDefaultText:"Seleccione Departamentos"});a.departamentosSettings={displayProp:"nombreDepartamento",idProp:"idDepartamento"};a.departamentosList=m.data;a.selectedDepartamentos=[];a.user={cardcolor:void 0,horario:"",diasAtencion:{lunes:!1,martes:!1,miercoles:!1,jueves:!1,viernes:!1,sabado:!1,domingo:!1},formaDePago:{contado:!1,debito:!1,credito:!1,otras:""}};a.dropdownsValid=!1;a.dropDownCheck=
function(){return 0<a.selectedDepartamentos.length&&0<a.selectedCategorias.length};a.fillEditUserCamps=function(){a.user=c.data.user;a.direcciones=c.data.direcciones;$.each(c.data.categorias,function(b,c){a.selectedCategorias.push({id:c.categoriaId})});var b=!1;$.each(c.data.departamentos,function(c,f){-1===$.inArray({id:f.idDepartamento},a.depSelected)&&a.selectedDepartamentos.push({id:f.idDepartamento});"montevideo"===f.nombreDepartamento.toLowerCase()&&(b=!0)});b&&(a.showBarrios=!0,$.each(c.data.departamentos,
function(b,f){"default"!==f.barrioNombre.toLowerCase()&&a.selectedBarrios.push({id:f.barrioId})}));var f={};f.lunes=1===parseInt(c.data.diasAtencion.lunes);f.martes=1===parseInt(c.data.diasAtencion.martes);f.miercoles=1===parseInt(c.data.diasAtencion.miercoles);f.jueves=1===parseInt(c.data.diasAtencion.jueves);f.viernes=1===parseInt(c.data.diasAtencion.viernes);f.sabado=1===parseInt(c.data.diasAtencion.sabado);f.domingo=1===parseInt(c.data.diasAtencion.domingo);var d={};d.contado=1===parseInt(c.data.formasDePago.contado);
d.debito=1===parseInt(c.data.formasDePago.debito);d.credito=1===parseInt(c.data.formasDePago.credito);d.otras=c.data.formasDePago.otras;a.user.diasAtencion=f;a.user.formaDePago=d;a.user.horario=c.data.diasAtencion.horario;a.IdPlan=a.user.plan;a.markers=$.parseJSON(c.data.user.markers);a.dropdownsValid=!0;a.registro.empresa=6<c.data.user.plan;q(function(){a.renderMap=!0},1E3)};a.init=function(){p?(a.markers=[],a.addDireccion()):a.fillEditUserCamps();goToTop()};a.checkCategoria=function(a){return 0>
parseInt(a.categoriaId)};a.checkDepto=function(a){return 0>parseInt(a.idDepartamento)};a.checkBarrio=function(b){return"Montevideo"===a.depSelected.nombreDepartamento&&0>parseInt(b.barrioId)};a.registrarUsuario=function(){a.dropdownsValid=a.dropDownCheck();if(a.registerUser.$valid&&a.dropdownsValid){var b=a.markers.map(function(a){return{latitude:a.position.G.toString(),longitude:a.position.K.toString()}}),b=JSON.stringify(b),f={},c;for(c=0;c<a.selectedCategorias.length;c++)$.extend(f,{id:a.selectedCategorias[c]});
a.removeDireccionesVacias();b={nombre:a.user.nombre,apellido:a.user.apellido,username:a.user.username,password:a.user.password,email:a.user.email,telefono:a.user.telefono,celular:a.user.celular,direccion:0<a.direcciones.length?JSON.stringify(a.direcciones):null,telefonoEmp:a.user.telefonoEmp,departamento:a.selectedDepartamentos,categoria:a.selectedCategorias,barrio:a.selectedBarrios,sitioWeb:a.user.sitioWeb,plan:parseInt(a.IdPlan),imagen:a.user.imagen,facebookUrl:a.user.facebookUrl,twitterUrl:a.user.twitterUrl,
linkedinUrl:a.user.linkedinUrl,descService:a.user.descService,cardcolor:a.user.cardcolor,servicioOfrecido1:a.user.servicioOfrecido1,servicioOfrecido2:a.user.servicioOfrecido2,servicioOfrecido3:a.user.servicioOfrecido3,servicioOfrecido4:a.user.servicioOfrecido4,servicioOfrecido5:a.user.servicioOfrecido5,servicioOfrecido6:a.user.servicioOfrecido6,descServiceLong:a.user.descServiceLong,formaDePago:a.user.formaDePago,diasAtencion:a.user.diasAtencion,horario:a.user.horario,markers:b};f=null;"undefined"!==
typeof a.files&&null!==a.files&&(f=a.files[0]);p?d.postRequestWithFile("api/agregar_usuario",b,f).then(function(a){a.data.success?(h.$broadcast("alert-event",{type:"success",msg:"Felicitaciones, ya sos parte de profesionales.uy"}),k.path("/index.html")):h.$broadcast("alert-event",{type:"danger",msg:a.data.msg})}):d.postRequestWithFile("api/editar_usuario",b,f).then(function(a){a.data.success?(h.$broadcast("alert-event",{type:"success",msg:"Datos actualizados!"}),k.path("/ver-usuario")):h.$broadcast("alert-event",
{type:"danger",msg:a.data.msg})})}else h.$broadcast("alert-event",{type:"danger",msg:"Verifique que todos los campos esten correctamente completados!"})};a.init();a.$on("$destroy",function(){a.renderMap=!1})}]);Professionals.controller("EditImgController",["$scope","$routeParams","$http","$rootScope","$location","$modalInstance","CommonService","imageUrl",function(a,h,k,d,m,e,l,g){a.ok=function(){e.close(a.selected.item)};a.cancel=function(){e.dismiss("cancel")};a.$watch("files",function(){a.validateImg(a.files)});a.validateImg=function(a){if(a&&a.length){a=a[0];var c;-1===a.type.indexOf("image")&&(c="Image extension not allowed, please choose a JPEG or PNG file.");2097152<a.size&&(c="File size cannot exceed 2 MB");
void 0!==c&&d.$broadcast("alert-event",{type:"danger",msg:c});return void 0===c}};a.userLogin={};a.editarImg=function(b){b.preventDefault();a.validateImg(a.files)&&(b=null,"undefined"!==typeof a.files&&null!==a.files&&(b=a.files[0]),l.postRequestWithFile("api/editar_img",{},b).then(function(a){a.data.success?(d.$broadcast("alert-event",{type:"success",msg:"Imagen actualizada!"}),e.close(0),g.set(a.data.data.newImgUrl)):d.$broadcast("alert-event",{type:"danger",msg:a.data.msg})}))}}]);Professionals.controller("VerUserController",["$scope","$location","departamentosList","categoriasList","barriosList","$modal","planes","Helper","userData","imageUrl",function(a,h,k,d,m,e,l,g,b,c){function p(a){var b="";$.each(a,function(a,c){""!==b&&(b+=", ");b+=c.categoriaNombre+" "});return b}function q(a){var b="";$.each(a,function(a,c){""!==b&&(b+=", ");b=1===parseInt(c.idDepartamento)?b+(c.barrioNombre+" ("+c.nombreDepartamento+")"):b+(c.nombreDepartamento+" ")});return b}function r(a){var b=
"";$.each(a,function(a,c){""!==b&&(b+=", ");b+=c.val+" "});return b}a.planes=l;a.newUser=!1;a.isCollapsed=!1;a.editMode=!1;a.registro={mostrarRegistro:!0,empresa:6<b.data.user.plan};a.barrios=m.data;a.barrios.unshift({barrioNombre:"Seleccione Barrio",barrioId:-1});a.selectedBarrio=a.barrios[0];a.categorias=d.data;a.categorias.unshift({categoriaNombre:"Seleccione Categoria",categoriaId:-1});a.selectedCategoria=a.categorias[0];a.departamentosList=k.data;a.departamentosList.unshift({nombreDepartamento:"Seleccione Departamento",
idDepartamento:-1});a.depSelected=a.departamentosList[0];k=new Date;k.setHours(8);k.setMinutes(0);a.user={horario:"",diasAtencion:{lunes:!1,martes:!1,miercoles:!1,jueves:!1,viernes:!1,sabado:!1,domingo:!1},formaDePago:{contado:!1,debito:!1,credito:!1,otras:""}};a.fillEditUserCamps=function(){a.user=b.data.user;a.user.direccion=r(b.data.direcciones);a.user.passwordConfirm=b.data.user.password;a.currentUsername=b.data.user.username;a.user.selectedCategoriaText=p(b.data.categorias);a.user.selectedDepartamentoText=
q(b.data.departamentos);if("montevideo"===a.depSelected.nombreDepartamento.toLowerCase()){var d=b.data.user.barrio;a.selectedBarrio=a.barrios.filter(function(a){return a.barrioId===d})[0];a.user.selectedBarrioText=a.selectedBarrio.barrioNombre}var f={};f.lunes=1===parseInt(b.data.diasAtencion.lunes);f.martes=1===parseInt(b.data.diasAtencion.martes);f.miercoles=1===parseInt(b.data.diasAtencion.miercoles);f.jueves=1===parseInt(b.data.diasAtencion.jueves);f.viernes=1===parseInt(b.data.diasAtencion.viernes);
f.sabado=1===parseInt(b.data.diasAtencion.sabado);f.domingo=1===parseInt(b.data.diasAtencion.domingo);var e={};e.contado=1===parseInt(b.data.formasDePago.contado);e.debito=1===parseInt(b.data.formasDePago.debito);e.credito=1===parseInt(b.data.formasDePago.credito);e.otras=b.data.formasDePago.otras;a.user.diasAtencion=f;a.user.formaDePago=e;a.user.formasDePagoText=g.getFormasDePagoText(e);a.user.diasAtencionText=g.getDiasAtencionText(f);a.user.horario=b.data.diasAtencion.horario;a.IdPlan=a.user.plan;
c.set(b.data.user.imagenUrl);a.imageUrl=c;a.markers=$.parseJSON(b.data.user.markers)};a.fillEditUserCamps();goToTop();a.editUserData=function(a){a.preventDefault();h.path("/editar-usuario")};a.editUserImg=function(a){a.preventDefault();a.stopPropagation();e.open({templateUrl:"resources/tpl/editImg.html",controller:"EditImgController",size:"lg"}).result.then(function(){},function(){})};a.editUserPwd=function(a){a.preventDefault();a.stopPropagation();e.open({templateUrl:"resources/tpl/editPwd.html",
controller:"EditPwdController",size:"lg"}).result.then(function(){},function(){})}}]);Professionals.controller("EditPwdController",["$scope","$routeParams","$http","$rootScope","$location","$modalInstance","CommonService",function(a,h,k,d,m,e,l){a.ok=function(){e.close(a.selected.item)};a.cancel=function(){e.dismiss("cancel")};a.userPwd={};a.editarPwd=function(g){g.preventDefault();debugger;l.postJsonRequest("api/edit-user-pwd",{oldPwd:a.userLogin.oldPwd,newPwd:a.userLogin.newPwd}).then(function(a){a.success?(d.$broadcast("alert-event",{type:"success",msg:"Contrase\u00f1a actualizada correctamente !"}),
e.close(0)):d.$broadcast("alert-event",{type:"danger",msg:a.msg})})}}]);